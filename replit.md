# Nuture Student Insurance Platform

## Overview

Nuture is a comprehensive student health insurance platform designed specifically for NUTM (Nigerian University of Technology and Management) students. The platform provides affordable healthcare coverage with features including policy management, claims submission and tracking, referral programs, weekly health quizzes, and health education resources.

The application is built as a modern full-stack web application using Python Flask for the backend REST API and React with TypeScript for the frontend. It integrates with Clerk for authentication and uses SQLite for data persistence (no external deployment dependencies required).

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Backend Architecture

**Framework:** Python Flask REST API
- The backend is a Flask application with modular route blueprints for each domain
- RESTful API design with JSON request/response format
- All endpoints are organized in api/routes/ directory
- Routes include: auth, users, plans, subscriptions, claims, payments, referrals, health_tips, quiz, and admin

**Authentication Pattern:**
- Clerk is used as the primary authentication provider
- Custom `@require_auth` decorator verifies Clerk tokens on protected endpoints
- User identity extracted from Clerk JWT tokens
- User ID and session data stored in Flask request context via `get_current_user_id()`

**Database Strategy:**
- SQLite database (api/nuture.db) for both development and production
- No external database dependencies - fully self-contained
- Database initialization via api/database.py with automatic table creation
- Schema includes tables for: users, insurance_plans, subscriptions, claims, payments, referrals, health_tips, quiz_questions, quiz_submissions, gamification_activities, gamification_streaks

**Quiz System:**
- 150 health-related questions stored in template week (week 1, 2025)
- Automatic weekly rotation - questions copy from template week to current week on first access
- ensure_questions_for_week() function handles auto-population for new weeks
- Weekly leaderboards track quiz performance and user rankings
- Gamification points awarded for quiz completion

**API Organization:**
- Each domain has its own blueprint file in api/routes/
- Endpoints use Flask decorators: @bp.route() for routing
- Authentication required via @require_auth decorator
- Database connections managed with context managers for safe transactions

### Frontend Architecture

**Framework:** React with TypeScript
- Vite as the build tool and development server
- React Router for client-side routing
- TanStack Query (React Query) for server state management and caching
- Clerk React SDK for authentication UI and hooks

**UI Component System:**
- Tailwind CSS v4 for styling with custom design tokens
- Radix UI for accessible, unstyled component primitives
- Custom component library built on Radix primitives (buttons, cards, forms, etc.)
- Dark mode as the default theme with custom color scheme featuring brand green (#00A859)

**State Management Approach:**
- Server state managed by TanStack Query with 5-minute stale time
- Authentication state handled by Clerk context
- Local UI state using React hooks
- No global state management library needed due to server-centric architecture

**Client-Server Communication:**
- Type-safe backend client auto-generated by Encore
- Custom `useBackend()` hook injects Clerk authentication tokens into requests
- Automatic request/response typing based on backend API definitions
- Environment-aware base URLs (local, preview, production)

### Data Storage Solutions

**Primary Database:**
- SQLite for development with migration to PostgreSQL for production
- Schema designed for relational data with foreign key constraints
- Timestamp tracking (created_at, updated_at) on all major tables
- JSON columns for flexible data (receipt URLs, plan features)

**Object Storage:**
- Encore Buckets for file storage (claim documents, profile pictures)
- Separate buckets with different access policies (public vs. private)
- Signed URL generation for secure upload/download operations
- TTL-based access control for uploaded documents

**Data Modeling Decisions:**
- Users identified by Clerk-provided IDs
- NUTM student IDs stored as unique identifiers (nutm_id)
- Email validation restricted to @nutm.edu.ng domain
- Subscriptions track active/expired/cancelled states with auto-renewal flags
- Claims include status workflow (pending â†’ approved/rejected)
- Gamification tracks streaks, points, and rank progression

### External Dependencies

**Authentication & User Management:**
- Clerk (clerk.com) - Provides OAuth, user management, session handling
- Integration via @clerk/backend SDK for token verification
- @clerk/clerk-react SDK for frontend authentication UI

**Payment Processing:**
- Currently mock implementation for development
- Transaction IDs generated internally
- Payment methods stored as strings (designed for future integration with Paystack or Flutterwave)

**Email Service:**
- Placeholder for email API integration (EmailAPIKey secret configured)
- Used for renewal reminders via cron job
- Implementation pending for actual email delivery service

**Frontend Libraries:**
- React Router DOM for navigation
- Lucide React for icons
- Tailwind CSS for styling with @tailwindcss/vite plugin
- TanStack Query for data fetching and caching

**Development Tools:**
- Bun as package manager (monorepo with workspaces)
- TypeScript for type safety across frontend and backend
- Vite for frontend build and HMR
- Encore CLI for local development and deployment

**API Integration Points:**
- Quiz question seeding from database
- Health tips content management
- Admin dashboard analytics aggregation
- Leaderboard computation based on quiz performance
- Referral tracking and completion workflow